<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>superduperdb.datalayer.mongodb.database API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>superduperdb.datalayer.mongodb.database</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">import gridfs
from bson import ObjectId
from pymongo import UpdateOne
from pymongo.cursor import Cursor
from pymongo.database import Database as MongoDatabase

import superduperdb.datalayer.mongodb.collection
from superduperdb.datalayer.base.database import BaseDatabase
from superduperdb.datalayer.mongodb import loading
from superduperdb.datalayer.mongodb.cursor import SuperDuperCursor
from superduperdb.misc.special_dicts import MongoStyleDict
from superduperdb.misc.logger import logging
from superduperdb.datalayer.mongodb.query import (
    Select,
    Delete,
    Insert,
    Update,
)


class Database(MongoDatabase, BaseDatabase):
    &#34;&#34;&#34;
    Database building on top of :code:`pymongo.database.Database`. Collections in the
    database are SuperDuperDB objects :code:`superduperdb.collection.Collection`.
    &#34;&#34;&#34;

    _database_type = &#39;mongodb&#39;
    select_cls = Select

    def __init__(self, *args, **kwargs):
        MongoDatabase.__init__(self, *args, **kwargs)
        BaseDatabase.__init__(self)
        self._filesystem = None
        self._filesystem_name = f&#39;_{self.name}:files&#39;

    def __getitem__(self, name: str):
        if name != &#39;_validation_sets&#39; and name.startswith(&#39;_&#39;):
            return super().__getitem__(name)
        return superduperdb.datalayer.mongodb.collection.Collection(self, name)

    @property
    def filesystem(self):
        if self._filesystem is None:
            self._filesystem = gridfs.GridFS(self.client[self._filesystem_name])
        return self._filesystem

    def _add_split_to_row(self, r, other):
        r[&#39;_other&#39;] = other
        return r

    def _base_delete(self, delete: Delete, **kwargs):
        return self[delete.collection]._base_delete(delete)

    def _base_insert(self, insert: Insert):
        return self[insert.collection]._base_insert_many(insert)

    def _base_update(self, update: Update):
        return self[update.collection]._base_update(update)

    def _convert_id_to_str(self, id_):
        return str(id_)

    def _convert_str_to_id(self, id_):
        return ObjectId(id_)

    def _create_job_record(self, r):
        self[&#39;_jobs&#39;].insert_one(r)

    def _create_component_entry(self, info):
        return self[&#39;_objects&#39;].insert_one(info)

    def _delete_component_info(self, identifier, variety):
        return self[&#39;_objects&#39;].delete_one(
            {&#39;identifier&#39;: identifier, &#39;variety&#39;: variety}
        )

    def _download_update(self, table, id, key, bytes_):
        return Update(
            collection=table,
            one=True,
            filter={&#39;_id&#39;: id},
            update={&#39;$set&#39;: {f&#39;{key}._content.bytes&#39;: bytes_}},
        )

    def _get_cursor(self, select: Select, features=None, scores=None):
        return SuperDuperCursor(
            self[select.collection],
            select.filter,
            select.projection,
            features=features,
            **select.kwargs,
        )

    def _get_output_from_document(self, r, key, model):
        return MongoStyleDict(r)[f&#39;_outputs.{key}.{model}&#39;]

    def _get_ids_from_select(self, select: Select):
        return [
            r[&#39;_id&#39;]
            for r in self[select.collection]._base_find(select.filter, {&#39;_id&#39;: 1})
        ]

    def _get_job_info(self, identifier):
        return self[&#39;_jobs&#39;].find_one({&#39;identifier&#39;: identifier})

    def get_meta_data(self, **kwargs):
        return self[&#39;_meta&#39;].find_one(kwargs)[&#39;value&#39;]

    def _get_object_info(self, identifier, variety, **kwargs):
        return self[&#39;_objects&#39;].find_one(
            {&#39;identifier&#39;: identifier, &#39;variety&#39;: variety, **kwargs}
        )

    def _get_object_info_where(self, variety, **kwargs):
        return self[&#39;_objects&#39;].find_one({&#39;variety&#39;: variety, **kwargs})

    def _get_raw_cursor(self, select: Select):
        return Cursor(
            self[select.collection], select.filter, select.projection, **select.kwargs
        )

    def get_query_for_validation_set(self, validation_set):
        return Select(
            collection=&#39;_validation_sets&#39;, filter={&#39;identifier&#39;: validation_set}
        )

    def _insert_validation_data(self, tmp, identifier):
        tmp = [{**r, &#39;identifier&#39;: identifier} for r in tmp]
        self.insert(Insert(&#39;_validation_sets&#39;, documents=tmp))

    def list_jobs(self, status=None):
        status = {} if status is None else {&#39;status&#39;: status}
        return list(
            self[&#39;_jobs&#39;].find(
                status, {&#39;identifier&#39;: 1, &#39;_id&#39;: 0, &#39;method&#39;: 1, &#39;status&#39;: 1, &#39;time&#39;: 1}
            )
        )

    def list_components(self, variety, **kwargs):
        return self[&#39;_objects&#39;].distinct(&#39;identifier&#39;, {&#39;variety&#39;: variety, **kwargs})

    def list_validation_sets(self):
        return self[&#39;_validation_sets&#39;].distinct(&#39;identifier&#39;)

    def _load_blob_of_bytes(self, file_id):
        return loading.load(file_id, filesystem=self.filesystem)

    def _replace_object(self, file_id, new_file_id, variety, identifier):
        self.filesystem.delete(file_id)
        self[&#39;_objects&#39;].update_one(
            {
                &#39;identifier&#39;: identifier,
                &#39;variety&#39;: variety,
            },
            {&#39;$set&#39;: {&#39;object&#39;: new_file_id}},
        )

    def _save_blob_of_bytes(self, bytes_):
        return loading.save(bytes_, self.filesystem)

    def separate_query_part_from_validation_record(self, r):
        return r[&#39;_other&#39;], {k: v for k, v in r.items() if k != &#39;_other&#39;}

    def _set_content_bytes(self, r, key, bytes_):
        if not isinstance(r, MongoStyleDict):
            r = MongoStyleDict(r)
        r[f&#39;{key}._content.bytes&#39;] = bytes_
        return r

    def set_job_flag(self, identifier, kw):
        self[&#39;_jobs&#39;].update_one({&#39;identifier&#39;: identifier}, {&#39;$set&#39;: {kw[0]: kw[1]}})

    def _unset_watcher_outputs(self, info):
        select = self.select_cls(**info[&#39;select&#39;])
        logging.info(f&#39;unsetting output field _outputs.{info[&#34;key&#34;]}.{info[&#34;model&#34;]}&#39;)
        return self._base_update(
            select.update({&#39;$unset&#39;: {f&#39;_outputs.{info[&#34;key&#34;]}.{info[&#34;model&#34;]}&#39;: 1}})
        )

    def _update_job_info(self, identifier, key, value):
        self[&#39;_jobs&#39;].update_one({&#39;identifier&#39;: identifier}, {&#39;$set&#39;: {key: value}})

    def _update_object_info(self, identifier, variety, key, value):
        self[&#39;_objects&#39;].update_one(
            {&#39;identifier&#39;: identifier, &#39;variety&#39;: variety}, {&#39;$set&#39;: {key: value}}
        )

    def write_output_to_job(self, identifier, msg, stream):
        assert stream in {&#39;stdout&#39;, &#39;stderr&#39;}
        self[&#39;_jobs&#39;].update_one({&#39;identifier&#39;: identifier}, {&#39;$push&#39;: {stream: msg}})

    def _write_watcher_outputs(self, watcher_info, outputs, _ids):
        logging.info(&#39;bulk writing...&#39;)
        select = self.select_cls(**watcher_info[&#39;select&#39;])
        if watcher_info.get(&#39;target&#39;) is None:
            out_key = f&#39;_outputs.{watcher_info[&#34;key&#34;]}.{watcher_info[&#34;model&#34;]}&#39;
        else:
            out_key = watcher_info[&#39;target&#39;]

        self[select.collection].bulk_write(
            [
                UpdateOne(
                    {&#39;_id&#39;: id},
                    {&#39;$set&#39;: {out_key: outputs[i]}},
                )
                for i, id in enumerate(_ids)
            ]
        )
        logging.info(&#39;done.&#39;)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="superduperdb.datalayer.mongodb.database.Database"><code class="flex name class">
<span>class <span class="ident">Database</span></span>
<span>(</span><span>*args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>Database building on top of :code:<code>pymongo.database.Database</code>. Collections in the
database are SuperDuperDB objects :code:<code>superduperdb.collection.Collection</code>.</p>
<p>Get a database by client and name.</p>
<p>Raises :class:<code>TypeError</code> if <code>name</code> is not an instance of
:class:<code>basestring</code> (:class:<code>str</code> in python 3). Raises
:class:<code>~pymongo.errors.InvalidName</code> if <code>name</code> is not a valid
database name.</p>
<p>:Parameters:
- <code>client</code>: A :class:<code>~pymongo.mongo_client.MongoClient</code> instance.
- <code>name</code>: The database name.
- <code>codec_options</code> (optional): An instance of
:class:<code>~bson.codec_options.CodecOptions</code>. If <code>None</code> (the
default) client.codec_options is used.
- <code>read_preference</code> (optional): The read preference to use. If
<code>None</code> (the default) client.read_preference is used.
- <code>write_concern</code> (optional): An instance of
:class:<code>~pymongo.write_concern.WriteConcern</code>. If <code>None</code> (the
default) client.write_concern is used.
- <code>read_concern</code> (optional): An instance of
:class:<code>~pymongo.read_concern.ReadConcern</code>. If <code>None</code> (the
default) client.read_concern is used.</p>
<div class="admonition seealso">
<p class="admonition-title">Seealso:&ensp;The MongoDB documentation on <code>databases &lt;https://dochub.mongodb.org/core/databases&gt;</code>_.</p>
</div>
<div class="admonition versionchanged">
<p class="admonition-title">Changed in version:&ensp;4.0</p>
<p>Removed the eval, system_js, error, last_status, previous_error,
reset_error_history, authenticate, logout, collection_names,
current_op, add_user, remove_user, profiling_level,
set_profiling_level, and profiling_info methods.
See the :ref:<code>pymongo4-migration-guide</code>.</p>
</div>
<div class="admonition versionchanged">
<p class="admonition-title">Changed in version:&ensp;3.2</p>
<p>Added the read_concern option.</p>
</div>
<div class="admonition versionchanged">
<p class="admonition-title">Changed in version:&ensp;3.0</p>
<p>Added the codec_options, read_preference, and write_concern options.
:class:<code>~pymongo.database.Database</code> no longer returns an instance
of :class:<code>~pymongo.collection.Collection</code> for attribute names
with leading underscores. You must use dict-style lookups instead::</p>
<pre><code>db['__my_collection__']
</code></pre>
<p>Not:</p>
<pre><code>db.__my_collection__
</code></pre>
</div></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Database(MongoDatabase, BaseDatabase):
    &#34;&#34;&#34;
    Database building on top of :code:`pymongo.database.Database`. Collections in the
    database are SuperDuperDB objects :code:`superduperdb.collection.Collection`.
    &#34;&#34;&#34;

    _database_type = &#39;mongodb&#39;
    select_cls = Select

    def __init__(self, *args, **kwargs):
        MongoDatabase.__init__(self, *args, **kwargs)
        BaseDatabase.__init__(self)
        self._filesystem = None
        self._filesystem_name = f&#39;_{self.name}:files&#39;

    def __getitem__(self, name: str):
        if name != &#39;_validation_sets&#39; and name.startswith(&#39;_&#39;):
            return super().__getitem__(name)
        return superduperdb.datalayer.mongodb.collection.Collection(self, name)

    @property
    def filesystem(self):
        if self._filesystem is None:
            self._filesystem = gridfs.GridFS(self.client[self._filesystem_name])
        return self._filesystem

    def _add_split_to_row(self, r, other):
        r[&#39;_other&#39;] = other
        return r

    def _base_delete(self, delete: Delete, **kwargs):
        return self[delete.collection]._base_delete(delete)

    def _base_insert(self, insert: Insert):
        return self[insert.collection]._base_insert_many(insert)

    def _base_update(self, update: Update):
        return self[update.collection]._base_update(update)

    def _convert_id_to_str(self, id_):
        return str(id_)

    def _convert_str_to_id(self, id_):
        return ObjectId(id_)

    def _create_job_record(self, r):
        self[&#39;_jobs&#39;].insert_one(r)

    def _create_component_entry(self, info):
        return self[&#39;_objects&#39;].insert_one(info)

    def _delete_component_info(self, identifier, variety):
        return self[&#39;_objects&#39;].delete_one(
            {&#39;identifier&#39;: identifier, &#39;variety&#39;: variety}
        )

    def _download_update(self, table, id, key, bytes_):
        return Update(
            collection=table,
            one=True,
            filter={&#39;_id&#39;: id},
            update={&#39;$set&#39;: {f&#39;{key}._content.bytes&#39;: bytes_}},
        )

    def _get_cursor(self, select: Select, features=None, scores=None):
        return SuperDuperCursor(
            self[select.collection],
            select.filter,
            select.projection,
            features=features,
            **select.kwargs,
        )

    def _get_output_from_document(self, r, key, model):
        return MongoStyleDict(r)[f&#39;_outputs.{key}.{model}&#39;]

    def _get_ids_from_select(self, select: Select):
        return [
            r[&#39;_id&#39;]
            for r in self[select.collection]._base_find(select.filter, {&#39;_id&#39;: 1})
        ]

    def _get_job_info(self, identifier):
        return self[&#39;_jobs&#39;].find_one({&#39;identifier&#39;: identifier})

    def get_meta_data(self, **kwargs):
        return self[&#39;_meta&#39;].find_one(kwargs)[&#39;value&#39;]

    def _get_object_info(self, identifier, variety, **kwargs):
        return self[&#39;_objects&#39;].find_one(
            {&#39;identifier&#39;: identifier, &#39;variety&#39;: variety, **kwargs}
        )

    def _get_object_info_where(self, variety, **kwargs):
        return self[&#39;_objects&#39;].find_one({&#39;variety&#39;: variety, **kwargs})

    def _get_raw_cursor(self, select: Select):
        return Cursor(
            self[select.collection], select.filter, select.projection, **select.kwargs
        )

    def get_query_for_validation_set(self, validation_set):
        return Select(
            collection=&#39;_validation_sets&#39;, filter={&#39;identifier&#39;: validation_set}
        )

    def _insert_validation_data(self, tmp, identifier):
        tmp = [{**r, &#39;identifier&#39;: identifier} for r in tmp]
        self.insert(Insert(&#39;_validation_sets&#39;, documents=tmp))

    def list_jobs(self, status=None):
        status = {} if status is None else {&#39;status&#39;: status}
        return list(
            self[&#39;_jobs&#39;].find(
                status, {&#39;identifier&#39;: 1, &#39;_id&#39;: 0, &#39;method&#39;: 1, &#39;status&#39;: 1, &#39;time&#39;: 1}
            )
        )

    def list_components(self, variety, **kwargs):
        return self[&#39;_objects&#39;].distinct(&#39;identifier&#39;, {&#39;variety&#39;: variety, **kwargs})

    def list_validation_sets(self):
        return self[&#39;_validation_sets&#39;].distinct(&#39;identifier&#39;)

    def _load_blob_of_bytes(self, file_id):
        return loading.load(file_id, filesystem=self.filesystem)

    def _replace_object(self, file_id, new_file_id, variety, identifier):
        self.filesystem.delete(file_id)
        self[&#39;_objects&#39;].update_one(
            {
                &#39;identifier&#39;: identifier,
                &#39;variety&#39;: variety,
            },
            {&#39;$set&#39;: {&#39;object&#39;: new_file_id}},
        )

    def _save_blob_of_bytes(self, bytes_):
        return loading.save(bytes_, self.filesystem)

    def separate_query_part_from_validation_record(self, r):
        return r[&#39;_other&#39;], {k: v for k, v in r.items() if k != &#39;_other&#39;}

    def _set_content_bytes(self, r, key, bytes_):
        if not isinstance(r, MongoStyleDict):
            r = MongoStyleDict(r)
        r[f&#39;{key}._content.bytes&#39;] = bytes_
        return r

    def set_job_flag(self, identifier, kw):
        self[&#39;_jobs&#39;].update_one({&#39;identifier&#39;: identifier}, {&#39;$set&#39;: {kw[0]: kw[1]}})

    def _unset_watcher_outputs(self, info):
        select = self.select_cls(**info[&#39;select&#39;])
        logging.info(f&#39;unsetting output field _outputs.{info[&#34;key&#34;]}.{info[&#34;model&#34;]}&#39;)
        return self._base_update(
            select.update({&#39;$unset&#39;: {f&#39;_outputs.{info[&#34;key&#34;]}.{info[&#34;model&#34;]}&#39;: 1}})
        )

    def _update_job_info(self, identifier, key, value):
        self[&#39;_jobs&#39;].update_one({&#39;identifier&#39;: identifier}, {&#39;$set&#39;: {key: value}})

    def _update_object_info(self, identifier, variety, key, value):
        self[&#39;_objects&#39;].update_one(
            {&#39;identifier&#39;: identifier, &#39;variety&#39;: variety}, {&#39;$set&#39;: {key: value}}
        )

    def write_output_to_job(self, identifier, msg, stream):
        assert stream in {&#39;stdout&#39;, &#39;stderr&#39;}
        self[&#39;_jobs&#39;].update_one({&#39;identifier&#39;: identifier}, {&#39;$push&#39;: {stream: msg}})

    def _write_watcher_outputs(self, watcher_info, outputs, _ids):
        logging.info(&#39;bulk writing...&#39;)
        select = self.select_cls(**watcher_info[&#39;select&#39;])
        if watcher_info.get(&#39;target&#39;) is None:
            out_key = f&#39;_outputs.{watcher_info[&#34;key&#34;]}.{watcher_info[&#34;model&#34;]}&#39;
        else:
            out_key = watcher_info[&#39;target&#39;]

        self[select.collection].bulk_write(
            [
                UpdateOne(
                    {&#39;_id&#39;: id},
                    {&#39;$set&#39;: {out_key: outputs[i]}},
                )
                for i, id in enumerate(_ids)
            ]
        )
        logging.info(&#39;done.&#39;)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>pymongo.database.Database</li>
<li>pymongo.common.BaseObject</li>
<li>typing.Generic</li>
<li><a title="superduperdb.datalayer.base.database.BaseDatabase" href="../base/database.html#superduperdb.datalayer.base.database.BaseDatabase">BaseDatabase</a></li>
</ul>
<h3>Instance variables</h3>
<dl>
<dt id="superduperdb.datalayer.mongodb.database.Database.filesystem"><code class="name">var <span class="ident">filesystem</span></code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def filesystem(self):
    if self._filesystem is None:
        self._filesystem = gridfs.GridFS(self.client[self._filesystem_name])
    return self._filesystem</code></pre>
</details>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="superduperdb.datalayer.mongodb.database.Database.get_meta_data"><code class="name flex">
<span>def <span class="ident">get_meta_data</span></span>(<span>self, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_meta_data(self, **kwargs):
    return self[&#39;_meta&#39;].find_one(kwargs)[&#39;value&#39;]</code></pre>
</details>
</dd>
<dt id="superduperdb.datalayer.mongodb.database.Database.get_query_for_validation_set"><code class="name flex">
<span>def <span class="ident">get_query_for_validation_set</span></span>(<span>self, validation_set)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_query_for_validation_set(self, validation_set):
    return Select(
        collection=&#39;_validation_sets&#39;, filter={&#39;identifier&#39;: validation_set}
    )</code></pre>
</details>
</dd>
<dt id="superduperdb.datalayer.mongodb.database.Database.list_components"><code class="name flex">
<span>def <span class="ident">list_components</span></span>(<span>self, variety, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def list_components(self, variety, **kwargs):
    return self[&#39;_objects&#39;].distinct(&#39;identifier&#39;, {&#39;variety&#39;: variety, **kwargs})</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="superduperdb.datalayer.base.database.BaseDatabase" href="../base/database.html#superduperdb.datalayer.base.database.BaseDatabase">BaseDatabase</a></b></code>:
<ul class="hlist">
<li><code><a title="superduperdb.datalayer.base.database.BaseDatabase.convert_from_bytes_to_types" href="../base/database.html#superduperdb.datalayer.base.database.BaseDatabase.convert_from_bytes_to_types">convert_from_bytes_to_types</a></code></li>
<li><code><a title="superduperdb.datalayer.base.database.BaseDatabase.convert_from_types_to_bytes" href="../base/database.html#superduperdb.datalayer.base.database.BaseDatabase.convert_from_types_to_bytes">convert_from_types_to_bytes</a></code></li>
<li><code><a title="superduperdb.datalayer.base.database.BaseDatabase.fit" href="../base/database.html#superduperdb.datalayer.base.database.BaseDatabase.fit">fit</a></code></li>
<li><code><a title="superduperdb.datalayer.base.database.BaseDatabase.list_jobs" href="../base/database.html#superduperdb.datalayer.base.database.BaseDatabase.list_jobs">list_jobs</a></code></li>
<li><code><a title="superduperdb.datalayer.base.database.BaseDatabase.list_validation_sets" href="../base/database.html#superduperdb.datalayer.base.database.BaseDatabase.list_validation_sets">list_validation_sets</a></code></li>
<li><code><a title="superduperdb.datalayer.base.database.BaseDatabase.predict" href="../base/database.html#superduperdb.datalayer.base.database.BaseDatabase.predict">predict</a></code></li>
<li><code><a title="superduperdb.datalayer.base.database.BaseDatabase.select_cls" href="../base/database.html#superduperdb.datalayer.base.database.BaseDatabase.select_cls">select_cls</a></code></li>
<li><code><a title="superduperdb.datalayer.base.database.BaseDatabase.separate_query_part_from_validation_record" href="../base/database.html#superduperdb.datalayer.base.database.BaseDatabase.separate_query_part_from_validation_record">separate_query_part_from_validation_record</a></code></li>
<li><code><a title="superduperdb.datalayer.base.database.BaseDatabase.set_job_flag" href="../base/database.html#superduperdb.datalayer.base.database.BaseDatabase.set_job_flag">set_job_flag</a></code></li>
<li><code><a title="superduperdb.datalayer.base.database.BaseDatabase.unset_hash_set" href="../base/database.html#superduperdb.datalayer.base.database.BaseDatabase.unset_hash_set">unset_hash_set</a></code></li>
<li><code><a title="superduperdb.datalayer.base.database.BaseDatabase.validate_component" href="../base/database.html#superduperdb.datalayer.base.database.BaseDatabase.validate_component">validate_component</a></code></li>
<li><code><a title="superduperdb.datalayer.base.database.BaseDatabase.watch_job" href="../base/database.html#superduperdb.datalayer.base.database.BaseDatabase.watch_job">watch_job</a></code></li>
<li><code><a title="superduperdb.datalayer.base.database.BaseDatabase.write_output_to_job" href="../base/database.html#superduperdb.datalayer.base.database.BaseDatabase.write_output_to_job">write_output_to_job</a></code></li>
</ul>
</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="superduperdb.datalayer.mongodb" href="index.html">superduperdb.datalayer.mongodb</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="superduperdb.datalayer.mongodb.database.Database" href="#superduperdb.datalayer.mongodb.database.Database">Database</a></code></h4>
<ul class="">
<li><code><a title="superduperdb.datalayer.mongodb.database.Database.filesystem" href="#superduperdb.datalayer.mongodb.database.Database.filesystem">filesystem</a></code></li>
<li><code><a title="superduperdb.datalayer.mongodb.database.Database.get_meta_data" href="#superduperdb.datalayer.mongodb.database.Database.get_meta_data">get_meta_data</a></code></li>
<li><code><a title="superduperdb.datalayer.mongodb.database.Database.get_query_for_validation_set" href="#superduperdb.datalayer.mongodb.database.Database.get_query_for_validation_set">get_query_for_validation_set</a></code></li>
<li><code><a title="superduperdb.datalayer.mongodb.database.Database.list_components" href="#superduperdb.datalayer.mongodb.database.Database.list_components">list_components</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>